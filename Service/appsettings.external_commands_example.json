{
  "ExternalCommands": {
    "Commands": [
      {
        "Id": "PrintPackageBarcodeXML",
        "Name": "Print Package Barcode Label (XML)",
        "Description": "Prints barcode label when package is created - XML format to local path",
        "ObjectType": "Package",
        "TriggerType": "CreatePackage",
        "Enabled": true,
        "Queries": [
          {
            "Name": "PackageData",
            "Query": "SELECT p.Id, p.Barcode, p.WhsCode, p.CreatedDate, p.CreatedByUserId, u.Name as CreatedByUser FROM Packages p LEFT JOIN Users u ON p.CreatedByUserId = u.Id WHERE p.Id = @PackageId",
            "ResultType": "Single"
          }
        ],
        "FileFormat": "XML",
        "FileNamePattern": "PKG_{Barcode}_{Timestamp:yyyyMMddHHmmss}.xml",
        "Destination": {
          "Type": "LocalPath",
          "Path": "C:\\PrintQueue\\Labels\\Incoming"
        }
      },
      {
        "Id": "PrintPackageContentJSON",
        "Name": "Print Package Content Label (JSON)",
        "Description": "Prints full content label when package is closed - JSON format to network path",
        "ObjectType": "Package",
        "TriggerType": "ClosePackage",
        "Enabled": true,
        "Queries": [
          {
            "Name": "PackageHeader",
            "Query": "SELECT p.Id, p.Barcode, p.WhsCode, p.ClosedDate, p.Status, b.BinCode as Location FROM Packages p LEFT JOIN Bins b ON p.BinEntry = b.BinEntry WHERE p.Id = @PackageId",
            "ResultType": "Single"
          },
          {
            "Name": "PackageContents",
            "Query": "SELECT pc.ItemCode, i.ItemName, pc.Quantity, pc.BatchNumbers, pc.SerialNumbers FROM PackageContents pc INNER JOIN Items i ON pc.ItemCode = i.ItemCode WHERE pc.PackageId = @PackageId",
            "ResultType": "Multiple"
          },
          {
            "Name": "PackageMetadata",
            "Query": "SELECT MetadataKey, MetadataValue FROM PackageMetadata WHERE PackageId = @PackageId",
            "ResultType": "Multiple"
          }
        ],
        "FileFormat": "JSON",
        "FileNamePattern": "PKG_CONTENT_{Barcode}_{Timestamp:yyyyMMddHHmmss}.json",
        "Destination": {
          "Type": "NetworkPath",
          "Path": "\\\\PrintServer\\Labels\\PackageContents",
          "UseNetworkImpersonation": true,
          "Username": "DOMAIN\\print_service",
          "Password": "encrypted_password_here"
        }
      },
      {
        "Id": "ExportPackageToFTP",
        "Name": "Export Package Data to FTP (XML)",
        "Description": "Exports package data to FTP server for external system integration",
        "ObjectType": "Package",
        "TriggerType": "Manual",
        "Enabled": true,
        "UIConfiguration": {
          "AllowedScreens": ["PackageDetails", "PackageList"],
          "ButtonText": "Export to External System",
          "RequireConfirmation": true,
          "ConfirmationMessage": "Are you sure you want to export this package to the external system?"
        },
        "Queries": [
          {
            "Name": "CompletePackageData",
            "Query": "SELECT p.*, b.BinCode, w.WhsName FROM Packages p LEFT JOIN Bins b ON p.BinEntry = b.BinEntry LEFT JOIN Warehouses w ON p.WhsCode = w.WhsCode WHERE p.Id = @PackageId",
            "ResultType": "Single"
          },
          {
            "Name": "ItemDetails",
            "Query": "SELECT pc.*, i.ItemName, i.ItemGroupCode, ig.ItemGroupName FROM PackageContents pc INNER JOIN Items i ON pc.ItemCode = i.ItemCode LEFT JOIN ItemGroups ig ON i.ItemGroupCode = ig.ItemGroupCode WHERE pc.PackageId = @PackageId",
            "ResultType": "Multiple"
          }
        ],
        "FileFormat": "XML",
        "FileNamePattern": "EXPORT_{WhsCode}_{Barcode}_{Timestamp:yyyyMMddHHmmss}.xml",
        "Destination": {
          "Type": "FTP",
          "Host": "ftp.external-system.com",
          "Port": 21,
          "Path": "/imports/packages",
          "Username": "ftp_user",
          "Password": "encrypted_ftp_password",
          "UsePassiveMode": true,
          "UseSsl": false
        }
      },
      {
        "Id": "SendPackageToSFTP",
        "Name": "Send Package to Partner SFTP (JSON)",
        "Description": "Sends package information to partner's SFTP server",
        "ObjectType": "Package",
        "TriggerType": "CreatePackage",
        "Enabled": false,
        "Queries": [
          {
            "Name": "PackageSummary",
            "Query": "SELECT p.Barcode, p.WhsCode, COUNT(DISTINCT pc.ItemCode) as ItemCount, SUM(pc.Quantity) as TotalQuantity FROM Packages p LEFT JOIN PackageContents pc ON p.Id = pc.PackageId WHERE p.Id = @PackageId GROUP BY p.Id, p.Barcode, p.WhsCode",
            "ResultType": "Single"
          }
        ],
        "FileFormat": "JSON",
        "FileNamePattern": "{WhsCode}_PKG_{Barcode}.json",
        "Destination": {
          "Type": "SFTP",
          "Host": "sftp.partner.com",
          "Port": 22,
          "Path": "/incoming/packages",
          "Username": "partner_integration",
          "Password": "encrypted_sftp_password",
          "PrivateKeyPath": "C:\\Keys\\partner_sftp_key.ppk",
          "PrivateKeyPassphrase": "encrypted_key_passphrase",
          "HostFingerprint": "ssh-rsa 2048 xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx"
        }
      },
      {
        "Id": "BatchPrintLabels",
        "Name": "Batch Print Multiple Package Labels",
        "Description": "Print labels for multiple packages at once",
        "ObjectType": "Package",
        "TriggerType": "Manual",
        "Enabled": true,
        "AllowBatchExecution": true,
        "UIConfiguration": {
          "AllowedScreens": ["PackageList"],
          "ButtonText": "Print Selected Labels",
          "RequireConfirmation": true,
          "ConfirmationMessage": "Print labels for {count} selected packages?",
          "MaxBatchSize": 100
        },
        "Queries": [
          {
            "Name": "BatchPackageData",
            "Query": "SELECT p.Id, p.Barcode, p.WhsCode, p.CreatedDate, b.BinCode FROM Packages p LEFT JOIN Bins b ON p.BinEntry = b.BinEntry WHERE p.Id IN (@PackageIds)",
            "ResultType": "Multiple",
            "IsBatchQuery": true
          }
        ],
        "FileFormat": "XML",
        "FileNamePattern": "BATCH_LABELS_{Timestamp:yyyyMMddHHmmss}_{BatchIndex}.xml",
        "Destination": {
          "Type": "LocalPath",
          "Path": "C:\\PrintQueue\\BatchLabels"
        }
      }
    ],
    "GlobalSettings": {
      "MaxConcurrentExecutions": 5,
      "CommandTimeout": 30,
      "RetryPolicy": {
        "MaxRetries": 3,
        "RetryDelaySeconds": 5,
        "RetryOnErrors": ["NetworkError", "TimeoutError"]
      },
      "FileEncoding": "UTF-8",
      "XmlSettings": {
        "RootElementName": "PackageData",
        "IncludeXmlDeclaration": true,
        "IndentXml": true
      },
      "JsonSettings": {
        "IndentJson": true,
        "CamelCasePropertyNames": false,
        "DateFormat": "yyyy-MM-ddTHH:mm:ss"
      }
    }
  }
}